#!/bin/bash 

mkdir build_dir

echo "Build UEFI files"
x86_64-w64-mingw32-gcc -ffreestanding -I/usr/local/include/efi -I/usr/local/include/efi/x86_64 -I/usr/local/include/efi/protocol -c -o build_dir/bootloader.o bootstrapping/uefi/bootloader.c
x86_64-w64-mingw32-gcc -ffreestanding -I/usr/local/include/efi -I/usr/local/include/efi/x86_64 -I/usr/local/include/efi/protocol -c -o build_dir/data.o bootstrapping/uefi/data.c
x86_64-w64-mingw32-gcc -ffreestanding -c -o build_dir/kernel.o kernel.c
x86_64-w64-mingw32-gcc -ffreestanding -c -o build_dir/graphics.o drivers/graphics.c
x86_64-w64-mingw32-gcc -ffreestanding -c -o build_dir/psf.o drivers/psf.c

echo "Link UEFI files"
x86_64-w64-mingw32-gcc -nostdlib -Wl,-dll -shared -Wl,--subsystem,10 -L /usr/local/lib -e efi_main -o ../SANDEROS64.EFI build_dir/kernel.o build_dir/psf.o build_dir/graphics.o build_dir/bootloader.o build_dir/data.o -lgcc

echo "Cleanup mess"
rm build_dir/*
rm -rf build_dir
